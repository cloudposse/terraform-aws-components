# Component: eks/tailscale

## Usage

**Stack Level**: Regional

Use this in the catalog or use these variables to overwrite the catalog values.

```yaml
components:
  terraform:
    eks/tailscale:
      vars:
        enabled: true
        name: tailscale
        create_namespace: true
        kubernetes_namespace: "tailscale"
        image_repo: tailscale/k8s-operator
        image_tag: unstable
```

## Requirements

| Name                                     | Version  |
| ---------------------------------------- | -------- |
| [terraform](./#requirement\_terraform)   | >= 1.0.0 |
| [aws](./#requirement\_aws)               | >= 4.0   |
| [kubernetes](./#requirement\_kubernetes) | >= 2.7.1 |

## Providers

| Name                                  | Version  |
| ------------------------------------- | -------- |
| [aws](./#provider\_aws)               | >= 4.0   |
| [kubernetes](./#provider\_kubernetes) | >= 2.7.1 |

## Modules

| Name                                  | Source                                             | Version |
| ------------------------------------- | -------------------------------------------------- | ------- |
| [eks](./#module\_eks)                 | cloudposse/stack-config/yaml//modules/remote-state | 1.4.1   |
| [iam\_roles](./#module\_iam\_roles)   | ../../account-map/modules/iam-roles                | n/a     |
| [store\_read](./#module\_store\_read) | cloudposse/ssm-parameter-store/aws                 | 0.10.0  |
| [this](./#module\_this)               | cloudposse/label/null                              | 0.25.0  |

## Resources

| Name                                                                                                                                                                | Type        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [kubernetes\_cluster\_role.tailscale\_operator](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/cluster\_role)                   | resource    |
| [kubernetes\_cluster\_role\_binding.tailscale\_operator](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/cluster\_role\_binding) | resource    |
| [kubernetes\_deployment.operator](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/deployment)                                    | resource    |
| [kubernetes\_namespace.default](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/namespace)                                       | resource    |
| [kubernetes\_role.operator](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/role)                                                | resource    |
| [kubernetes\_role.proxies](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/role)                                                 | resource    |
| [kubernetes\_role\_binding.operator](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/role\_binding)                              | resource    |
| [kubernetes\_role\_binding.proxies](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/role\_binding)                               | resource    |
| [kubernetes\_secret.operator\_oauth](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/secret)                                     | resource    |
| [kubernetes\_service\_account.operator](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/service\_account)                        | resource    |
| [kubernetes\_service\_account.proxies](https://registry.terraform.io/providers/hashicorp/kubernetes/latest/docs/resources/service\_account)                         | resource    |
| [aws\_eks\_cluster.kubernetes](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/eks\_cluster)                                         | data source |
| [aws\_eks\_cluster\_auth.eks](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/eks\_cluster\_auth)                                    | data source |
| [aws\_subnet.vpc\_subnets](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/subnet)                                                   | data source |

## Inputs

| Name                                                                                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Type           | Default                                                                                                                                                                                                                                                                                                                                                                                                                                  | Required |
| -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| [additional\_tag\_map](./#input\_additional\_tag\_map)                                       | <p>Additional key-value pairs to add to each map in <code>tags_as_list_of_maps</code>. Not added to <code>tags</code> or <code>id</code>.<br>This is for some rare cases where resources want additional configuration of tags<br>and therefore take a list of maps with tag key, value, and additional configuration.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `map(string)`  | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [attributes](./#input\_attributes)                                                           | <p>ID element. Additional attributes (e.g. <code>workers</code> or <code>cluster</code>) to add to <code>id</code>,<br>in the order they appear in the list. New attributes are appended to the<br>end of the list. The elements of the list are joined by the <code>delimiter</code><br>and treated as a single ID element.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `list(string)` | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [chart\_values](./#input\_chart\_values)                                                     | Addition map values to yamlencode as `helm_release` values.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `any`          | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [context](./#input\_context)                                                                 | <p>Single object for setting entire context at once.<br>See description of individual variables for details.<br>Leave string and numeric variables as <code>null</code> to use default value.<br>Individual variable settings (non-null) override settings in context object,<br>except for attributes, tags, and additional_tag_map, which are merged.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `any`          | <pre><code>{
  "additional_tag_map": {},
  "attributes": [],
  "delimiter": null,
  "descriptor_formats": {},
  "enabled": true,
  "environment": null,
  "id_length_limit": null,
  "label_key_case": null,
  "label_order": [],
  "label_value_case": null,
  "labels_as_tags": [
    "unset"
  ],
  "name": null,
  "namespace": null,
  "regex_replace_chars": null,
  "stage": null,
  "tags": {},
  "tenant": null
}
</code></pre> |    no    |
| [create\_namespace](./#input\_create\_namespace)                                             | Create the namespace if it does not yet exist. Defaults to `false`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| [delimiter](./#input\_delimiter)                                                             | <p>Delimiter to be used between ID elements.<br>Defaults to <code>-</code> (hyphen). Set to <code>""</code> to use no delimiter at all.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [deployment\_name](./#input\_deployment\_name)                                               | Name of the tailscale deployment, defaults to `tailscale` if this is null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [descriptor\_formats](./#input\_descriptor\_formats)                                         | <p>Describe additional descriptors to be output in the <code>descriptors</code> output map.<br>Map of maps. Keys are names of descriptors. Values are maps of the form<br><code>{&#x3C;br> format = string&#x3C;br> labels = list(string)&#x3C;br>}</code><br>(Type is <code>any</code> so the map values can later be enhanced to provide additional options.)<br><code>format</code> is a Terraform format string to be passed to the <code>format()</code> function.<br><code>labels</code> is a list of labels, in order, to pass to <code>format()</code> function.<br>Label values will be normalized before being passed to <code>format()</code> so they will be<br>identical to how they appear in <code>id</code>.<br>Default is <code>{}</code> (<code>descriptors</code> output will be empty).</p> | `any`          | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [eks\_component\_name](./#input\_eks\_component\_name)                                       | The name of the eks component                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`       | `"eks/cluster"`                                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| [enabled](./#input\_enabled)                                                                 | Set to false to prevent the module from creating any resources                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `bool`         | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [env](./#input\_env)                                                                         | Map of ENV vars in the format `key=value`. These ENV vars will be set in the `utils` provider before executing the data source                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `map(string)`  | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [environment](./#input\_environment)                                                         | ID element. Usually used for region e.g. 'uw2', 'us-west-2', OR role 'prod', 'staging', 'dev', 'UAT'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [helm\_manifest\_experiment\_enabled](./#input\_helm\_manifest\_experiment\_enabled)         | Enable storing of the rendered manifest for helm\_release so the full diff of what is changing can been seen in the plan                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [id\_length\_limit](./#input\_id\_length\_limit)                                             | <p>Limit <code>id</code> to this many characters (minimum 6).<br>Set to <code>0</code> for unlimited length.<br>Set to <code>null</code> for keep the existing setting, which defaults to <code>0</code>.<br>Does not affect <code>id_full</code>.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `number`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [image\_repo](./#input\_image\_repo)                                                         | Image repository for the deployment                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `string`       | `"ghcr.io/tailscale/tailscale"`                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| [image\_tag](./#input\_image\_tag)                                                           | Image Tag for the deployment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`       | `"latest"`                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| [import\_profile\_name](./#input\_import\_profile\_name)                                     | AWS Profile name to use when importing a resource                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [import\_role\_arn](./#input\_import\_role\_arn)                                             | IAM Role ARN to use when importing a resource                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [kube\_data\_auth\_enabled](./#input\_kube\_data\_auth\_enabled)                             | <p>If <code>true</code>, use an <code>aws_eks_cluster_auth</code> data source to authenticate to the EKS cluster.<br>Disabled by <code>kubeconfig_file_enabled</code> or <code>kube_exec_auth_enabled</code>.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| [kube\_exec\_auth\_aws\_profile](./#input\_kube\_exec\_auth\_aws\_profile)                   | The AWS config profile for `aws eks get-token` to use                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `string`       | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [kube\_exec\_auth\_aws\_profile\_enabled](./#input\_kube\_exec\_auth\_aws\_profile\_enabled) | If `true`, pass `kube_exec_auth_aws_profile` as the `profile` to `aws eks get-token`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| [kube\_exec\_auth\_enabled](./#input\_kube\_exec\_auth\_enabled)                             | <p>If <code>true</code>, use the Kubernetes provider <code>exec</code> feature to execute <code>aws eks get-token</code> to authenticate to the EKS cluster.<br>Disabled by <code>kubeconfig_file_enabled</code>, overrides <code>kube_data_auth_enabled</code>.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [kube\_exec\_auth\_role\_arn](./#input\_kube\_exec\_auth\_role\_arn)                         | The role ARN for `aws eks get-token` to use                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `string`       | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [kube\_exec\_auth\_role\_arn\_enabled](./#input\_kube\_exec\_auth\_role\_arn\_enabled)       | If `true`, pass `kube_exec_auth_role_arn` as the role ARN to `aws eks get-token`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `bool`         | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [kube\_secret](./#input\_kube\_secret)                                                       | Kube Secret Name for tailscale                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `string`       | `"tailscale"`                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| [kubeconfig\_context](./#input\_kubeconfig\_context)                                         | Context to choose from the Kubernetes kube config file                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `string`       | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [kubeconfig\_exec\_auth\_api\_version](./#input\_kubeconfig\_exec\_auth\_api\_version)       | The Kubernetes API version of the credentials returned by the `exec` auth plugin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `string`       | `"client.authentication.k8s.io/v1beta1"`                                                                                                                                                                                                                                                                                                                                                                                                 |    no    |
| [kubeconfig\_file](./#input\_kubeconfig\_file)                                               | The Kubernetes provider `config_path` setting to use when `kubeconfig_file_enabled` is `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`       | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [kubeconfig\_file\_enabled](./#input\_kubeconfig\_file\_enabled)                             | If `true`, configure the Kubernetes provider with `kubeconfig_file` and use that kubeconfig file for authenticating to the EKS cluster                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `bool`         | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| [kubernetes\_namespace](./#input\_kubernetes\_namespace)                                     | The namespace to install the release into.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`       | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                      |    yes   |
| [label\_key\_case](./#input\_label\_key\_case)                                               | <p>Controls the letter case of the <code>tags</code> keys (label names) for tags generated by this module.<br>Does not affect keys of tags passed in via the <code>tags</code> input.<br>Possible values: <code>lower</code>, <code>title</code>, <code>upper</code>.<br>Default value: <code>title</code>.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [label\_order](./#input\_label\_order)                                                       | <p>The order in which the labels (ID elements) appear in the <code>id</code>.<br>Defaults to ["namespace", "environment", "stage", "name", "attributes"].<br>You can omit any of the 6 labels ("tenant" is the 6th), but at least one must be present.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `list(string)` | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [label\_value\_case](./#input\_label\_value\_case)                                           | <p>Controls the letter case of ID elements (labels) as included in <code>id</code>,<br>set as tag values, and output by this module individually.<br>Does not affect values of tags passed in via the <code>tags</code> input.<br>Possible values: <code>lower</code>, <code>title</code>, <code>upper</code> and <code>none</code> (no transformation).<br>Set this to <code>title</code> and set <code>delimiter</code> to <code>""</code> to yield Pascal Case IDs.<br>Default value: <code>lower</code>.</p>                                                                                                                                                                                                                                                                                                | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [labels\_as\_tags](./#input\_labels\_as\_tags)                                               | <p>Set of labels (ID elements) to include as tags in the <code>tags</code> output.<br>Default is to include all labels.<br>Tags with empty values will not be included in the <code>tags</code> output.<br>Set to <code>[]</code> to suppress all generated tags.<br><strong>Notes:</strong><br>The value of the <code>name</code> tag, if included, will be the <code>id</code>, not the <code>name</code>.<br>Unlike other <code>null-label</code> inputs, the initial setting of <code>labels_as_tags</code> cannot be<br>changed in later chained modules. Attempts to change it will be silently ignored.</p>                                                                                                                                                                                              | `set(string)`  | <pre><code>[
  "default"
]
</code></pre>                                                                                                                                                                                                                                                                                                                                                                                                 |    no    |
| [name](./#input\_name)                                                                       | <p>ID element. Usually the component or solution name, e.g. 'app' or 'jenkins'.<br>This is the only ID element not also included as a <code>tag</code>.<br>The "name" tag is set to the full <code>id</code> string. There is no tag with the value of the <code>name</code> input.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [namespace](./#input\_namespace)                                                             | ID element. Usually an abbreviation of your organization name, e.g. 'eg' or 'cp', to help ensure generated IDs are globally unique                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [regex\_replace\_chars](./#input\_regex\_replace\_chars)                                     | <p>Terraform regular expression (regex) string.<br>Characters matching the regex will be removed from the ID elements.<br>If not set, <code>"/[^a-zA-Z0-9-]/"</code> is used to remove all characters other than hyphens, letters and digits.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [region](./#input\_region)                                                                   | AWS Region                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`       | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                      |    yes   |
| [routes](./#input\_routes)                                                                   | List of CIDR Ranges or IPs to allow Tailscale to connect to                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `list(string)` | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [stage](./#input\_stage)                                                                     | ID element. Usually used to indicate role, e.g. 'prod', 'staging', 'source', 'build', 'test', 'deploy', 'release'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| [tags](./#input\_tags)                                                                       | <p>Additional tags (e.g. <code>{'BusinessUnit': 'XYZ'}</code>).<br>Neither the tag keys nor the tag values will be modified by this module.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `map(string)`  | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| [tenant](./#input\_tenant)                                                                   | ID element \_(Rarely used, not included by default)\_. A customer identifier, indicating who this instance of a resource is for                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`       | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |

## Outputs

| Name                                | Description |
| ----------------------------------- | ----------- |
| [deployment](./#output\_deployment) | n/a         |
|                                     |             |

## References

* https://github.com/Ealenn/tailscale
